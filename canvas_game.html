<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<style>
  canvas {
    border:1px solid #d3d3d3;
    background-color: #f1f1f1;
}
</style>
</head>
<body onload="startGame()">
<script>
  function startGame() {
  myGameArea.start();
}

var myGameArea = {
  canvas: document.createElement("canvas"),
  start: function () {
    this.canvas.width = 480;
    this.canvas.height = 270;
    this.context = this.canvas.getContext("2d");
    document.body.insertBefore(this.canvas, document.body.childNodes[0]);
    this.interval = setInterval(updateGameArea, 20);
    window.addEventListener("keydown", function (e) {
      myGameArea.keys = (myGameArea.keys || []);
      myGameArea.keys[e.keyCode] = true;
    })
    window.addEventListener("keyup", function (e) {
      myGameArea.keys[e.keyCode] = false;
    })
  },
  clear: function () {
    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
  },
  stop: function() {
    clearInterval(this.interval)
    startGame();
  }
};

var myGamePiece;

var myEnemy;

function startGame() {
  myGameArea.start();
  myGamePiece = new component(10, 10, "red", 240, 135, "player");
  myEnemy = new component(5, 5, "blue", 300, 72, "enemy");
  myEnemy.x = Math.floor(Math.random() * 475);
  myEnemy.y = Math.floor(Math.random() * 265);
  // myEnemy.speedX = randoDirect();
  // myEnemy.speedY = randoDirect();
}

function randoDirect() {
  x = Math.random() * 2;
  if(x < 0.55){
    x = 0.55
  }
  if(x > 1.65){
    x = 1.65
  }
  console.log("x: " + x)
  y = Math.floor(Math.random() * 2)
  console.log("y: " + y);
  if(y === 1) {
    x = -Math.abs(x)
  }
  return x;
}

function component(width, height, color, x, y, type) {
  this.width = width;
  this.height = height;
  this.speedX = 0;
  this.speedY = 0;
  this.x = x;
  this.y = y;
  this.type = type
  if(this.type === "enemy") {
    this.gravity = 0.05;
    this.gravitySpeed = 0;
  }
  this.update = function () {
    ctx = myGameArea.context;
    if(this.type === "enemy") {
      ctx.fillStyle = "rgb(" + Math.floor(Math.random() * 255) + "," + Math.floor(Math.random() * 255) + "," + Math.floor(Math.random() * 255) + ")";
    }
    else{
    ctx.fillStyle = color;
    }
    ctx.fillRect(this.x, this.y, this.width, this.height);
  };
  this.newPos = function () {
    this.x += this.speedX;
    this.y += this.speedY;
    if (this.type === "player") {
    if(this.x > 470) {
      this.x = 470
    }
    if(this.x < 0){
      this.x = 0
    }
    if(this.y > 260) {
      this.y = 260
    }
    if(this.y < 0) {
      this.y = 0
    }}
    if (this.type === "enemy"){
    if(this.x > 475) {
      this.x = 475
    }
    if(this.x < 0) {
      this.x = 0
    }
    if(this.y > 265) {
      this.y = 265
    }
    if(this.y < 0) {
      this.y = 0
    }
    if(this.x < myGamePiece.x && this.y < myGamePiece.y){
    this.gravitySpeed += this.gravity
    this.x += this.speedX + this.gravitySpeed;
    this.y += this.speedY + this.gravitySpeed;
    }
    if(this.x > myGamePiece.x && this.y > myGamePiece.y){
    this.gravitySpeed += this.gravity
    this.x += this.speedX - this.gravitySpeed
    this.y += this.speedY - this.gravitySpeed
    }
    if(this.x < myGamePiece.x && this.y > myGamePiece.y){
    this.gravitySpeed += this.gravity
    this.x += this.speedX + this.gravitySpeed
    this.y += this.speedY - this.gravitySpeed
    }
    if(this.x > myGamePiece.x && this.y < myGamePiece.y){
    this.gravitySpeed += this.gravity
    this.x += this.speedX - this.gravitySpeed
    this.y += this.speedY + this.gravitySpeed
    }
    if(this.x === myGamePiece.x){
      this.gravitySpeed += this.gravity
      this.x += this.speedX + this.gravitySpeed
    }
    if(this.y === myGamePiece.y){
      this.gravitySpeed += this.gravity
      this.y += this.speedY + this.gravitySpeed
    }
    console.log("Grav Speed: " + this.gravitySpeed);
    this.hitBottom();
  }
},
  this.hitBottom = function() {
    var rockBottom = myGameArea.canvas.height - this.height;
    var rockRight = myGameArea.canvas.width - this.width;
      if (this.y > rockBottom) {
        this.y = rockBottom;
        console.log("Triggered rockBottom");
      }
      if(this.x > rockRight) {
        this.x = rockRight;
        console.log("Triggered rockRight");
      }
  }
  this.crashWith = function(otherObj) {
    var myLeft = this.x;
    var myRight = this.x + (this.width);
    var myTop = this.y;
    var myBottom = this.y + (this.height);
    var otherLeft = otherObj.x
    var otherRight = otherObj.x + (otherObj.width);
    var otherTop = otherObj.y;
    var otherBot = otherObj.y + (otherObj.height);
    var crash = true;
    if((myBottom < otherTop) || (myTop > otherBot) || (myLeft > otherRight) || (myRight < otherLeft)) {
      crash = false;
    }
    return crash;
  }
}

function updateGameArea() {
  if (myGamePiece.crashWith(myEnemy)) {
    myGameArea.stop();
  }
  else {
  myGameArea.clear();
  myEnemy.newPos();
  myEnemy.update();
  // console.log("X: " + myEnemy.x);
  // console.log("Y: " + myEnemy.y);
  myGamePiece.speedX = 0;
  myGamePiece.speedY = 0;
  if (myGameArea.keys && myGameArea.keys[37]) {
    myGamePiece.speedX = -1
  }
  if (myGameArea.keys && myGameArea.keys[39]) {
    myGamePiece.speedX = 1;
  }
  if (myGameArea.keys && myGameArea.keys[38]) {
    myGamePiece.speedY = -1; 
  }
  if (myGameArea.keys && myGameArea.keys[40]) {
    myGamePiece.speedY = 1; 
  }
  myGamePiece.newPos();
  myGamePiece.update();
}}

// Original function I wrote for movement. Not exactly obsolete because it tackles movement in a different fashion, but for the time-being it's being put to sleep. Could be useful for a space game or something.

// document.onkeyup = function(event) {
//   var uInput = event.key;
//   console.log(uInput);
//   switch (uInput) {
//     case "ArrowLeft":
//       myGamePiece.speedX -= 1;
//       console.log("left case")
//       break;
//     case "ArrowRight":
//       myGamePiece.speedX += 1;
//       console.log("right case")
//       break;
//     case "ArrowUp":
//       myGamePiece.speedY -= 1;
//       console.log("up case")
//       break;
//     case "ArrowDown":
//       myGamePiece.speedY += 1;
//       console.log("down case")
//       break;
//     case "]":
//       console.log("Xpos: " + myGamePiece.x + " Ypos: " + myGamePiece.y);
//     default:
//       console.log("break case")
//       break;
//   }
// }

</script>
</body>
</html>